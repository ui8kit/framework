# UI8Kit Generator Package Rules

## ğŸ“¦ Package Purpose
The `@ui8kit/generator` package is the orchestration layer for static site generation. It coordinates between rendering React components, extracting CSS, and generating final HTML pages using Liquid templates.

## ğŸ¯ Core Responsibilities

### 1. Orchestration & Coordination
- **Process Management**: Coordinate the entire static generation pipeline
- **Configuration Management**: Read and validate generator configuration
- **Error Aggregation**: Collect and report errors from all generation steps

### 2. View Generation
- **React Rendering**: Delegate to `@ui8kit/render` for React â†’ HTML conversion
- **Liquid Views**: Store rendered HTML as `.liquid` view files
- **Route Processing**: Process all routes defined in configuration

### 3. CSS Generation
- **HTML Analysis**: Extract classes from generated views
- **Semantic CSS**: Generate CSS with `@apply` directives and pure CSS3
- **File Merging**: Combine CSS from multiple routes

### 4. HTML Assembly
- **Liquid Rendering**: Use Liquid templates to assemble final HTML
- **Layout Application**: Apply layouts, partials, and metadata
- **Static Output**: Generate final HTML files for deployment

## ğŸ”§ Technical Implementation

### Configuration Structure
```typescript
interface GeneratorConfig {
  app: { name: string; lang?: string };
  css: { entryPath: string; routes: string[]; outputDir: string; pureCss?: boolean };
  html: { viewsDir: string; routes: Record<string, RouteConfig>; outputDir: string };
  assets?: { copy?: string[] };
}
```

### Generation Pipeline
1. **Views**: React components â†’ HTML with `data-class` â†’ Liquid views
2. **CSS**: HTML analysis â†’ `@apply` CSS + pure CSS3 â†’ merged files
3. **HTML**: Liquid views + layouts â†’ final HTML pages
4. **Assets**: Copy static files to output directories

### File Organization
```
apps/local/
â”œâ”€â”€ views/           # Generated Liquid views
â”‚   â”œâ”€â”€ pages/       # Route-specific content
â”‚   â”œâ”€â”€ layouts/     # Layout templates
â”‚   â””â”€â”€ partials/    # Reusable components
â”œâ”€â”€ dist/
â”‚   â”œâ”€â”€ css/         # Generated stylesheets
â”‚   â””â”€â”€ html/        # Final HTML pages
â””â”€â”€ generator.config.ts  # Configuration
```

## ğŸš« Restrictions & Best Practices

### Dependencies
- âœ… **Allowed**: Liquid.js, file system operations, HTML processing
- âŒ **Forbidden**: React, UI libraries, CSS frameworks, runtime dependencies

### Framework Independence
- âœ… **No React Coupling**: Generator should work with any rendering engine
- âœ… **Template Agnostic**: Support multiple template engines (Liquid, Handlebars, etc.)
- âŒ **Framework Specifics**: Don't hardcode React-specific logic

### Configuration First
- âœ… **Config Driven**: All paths and options come from configuration
- âœ… **Validation**: Validate configuration before processing
- âŒ **Hardcoded Paths**: No application-specific paths in package code

### Error Handling
- âœ… **Non-Breaking**: Continue processing other routes if one fails
- âœ… **Clear Messages**: Provide actionable error messages
- âŒ **Silent Failures**: Always report issues and their impact

## ğŸ”„ Integration Points

### Render Package Integration
- **Calls**: `@ui8kit/render` for React component rendering
- **Provides**: Route configuration and app context
- **Receives**: HTML strings with `data-class` attributes

### Application Configuration
- **Reads from**: `apps/*/generator.config.ts`
- **Validates**: Configuration structure and required fields
- **Uses**: All config sections (app, css, html, assets)

### Build System Integration
- **Called by**: Application build scripts
- **Outputs to**: Configured output directories
- **Triggers**: Manual generation or automated builds

## ğŸ“‹ Development Workflow

1. **Configuration**: App defines routes and settings in `generator.config.ts`
2. **View Generation**: Generator calls renderer for each route
3. **CSS Extraction**: Analyze generated HTML for classes and styles
4. **HTML Assembly**: Combine views with Liquid templates
5. **Asset Copying**: Copy static files to output directories

## ğŸ¨ HTML Generation Strategy

### Data-Class Preservation
- **Semantic Selectors**: Use `data-class` for meaningful CSS targeting
- **Attribute Forwarding**: Preserve all `data-class` attributes in output
- **CSS Compatibility**: Ensure generated CSS works with data-class selectors

### Liquid Template System
```liquid
<!-- layouts/layout.liquid -->
<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
  <title>{{ title }}</title>
  {% include 'partials/head.liquid' %}
</head>
<body>
  {% include 'partials/header.liquid' %}
  <main>{{ content }}</main>
  {% include 'partials/footer.liquid' %}
</body>
</html>
```

## ğŸ” Quality Assurance

- **File Generation**: Verify all expected files are created
- **HTML Validity**: Ensure generated HTML is well-formed
- **CSS Compatibility**: Generated CSS should work with the target framework
- **Performance**: Generation should complete in reasonable time
- **Configuration Coverage**: All config options should be tested