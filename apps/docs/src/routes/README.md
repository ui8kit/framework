# Docs Routes

This folder contains route components for the documentation application.

## Architecture

The docs app uses a **docs-first routing** approach where:
1. **Dev Mode**: Routes are derived from MDX files via `import.meta.glob`
2. **Build Mode**: Static HTML is generated by `@ui8kit/generator` with `MdxService`

## DocsPage Component

The main route handler that dynamically loads MDX content based on URL path.

```tsx
import { DocsPage } from './DocsPage'

// In App.tsx
<Routes>
  <Route path="/*" element={<DocsPage />} />
</Routes>
```

### URL to MDX Mapping

| URL | MDX File |
|-----|----------|
| `/` | `docs/index.mdx` |
| `/components` | `docs/components/index.mdx` |
| `/components/button` | `docs/components/button.mdx` |
| `/tutorials/getting-started` | `docs/tutorials/getting-started.mdx` |

### Key Functions

#### getMdxPath(pathname)

Converts URL pathname to MDX module path:

```typescript
getMdxPath('/')                    // → '../../docs/index.mdx'
getMdxPath('/components')          // → '../../docs/components/index.mdx'
getMdxPath('/components/button')   // → '../../docs/components/button.mdx'
```

#### mdxModules (Vite glob)

```typescript
const mdxModules = import.meta.glob<MdxModule>('../../docs/**/*.mdx')
```

Returns a map of all MDX files with lazy loaders.

## Imports from @ui8kit/mdx-react

```typescript
// React context and hooks (browser-safe)
import { 
  PageContentProvider,  // Provides MDX content to children
  usePageContent,       // Access Content, frontmatter, toc
  useToc,               // Get table of contents array
} from '@ui8kit/mdx-react'

// Type definitions
import type { 
  TocEntry,     // { depth, text, slug }
  Frontmatter,  // { title?, description?, order?, ... }
} from '@ui8kit/mdx-react'
```

## Component Structure

```
DocsPage
├── MdxPageLoader       # Loads MDX module, handles loading/error states
│   └── PageContentProvider
│       └── DocsLayout
│           ├── DocsNavigation   # Sidebar with page links
│           ├── DocsContent      # Main article with Content component
│           └── TableOfContents  # TOC sidebar
├── DocsLoading         # Loading fallback
└── DocsNotFound        # 404 page with available routes
```

## DocsLayout

Three-column layout:

```
┌─────────────────────────────────────────────────────┐
│                     Header                          │
├──────────┬──────────────────────────────┬───────────┤
│          │                              │           │
│ Sidebar  │        Main Content          │    TOC    │
│  (nav)   │        (article)             │           │
│          │                              │           │
└──────────┴──────────────────────────────┴───────────┘
```

## Navigation Building

Navigation is built from available MDX paths:

```typescript
const availablePaths = Object.keys(mdxModules).map(path => {
  return path
    .replace('../../docs', '')
    .replace(/\/index\.mdx$/, '')
    .replace(/\.mdx$/, '') || '/'
})
// ['/', '/components', '/components/button', '/tutorials/getting-started']
```

## usePageContent Hook

Provides access to loaded MDX content:

```typescript
function DocsLayout() {
  const { Content, frontmatter } = usePageContent()
  
  return (
    <article>
      <h1>{frontmatter.title}</h1>
      <Content /> {/* Rendered MDX */}
    </article>
  )
}
```

## useToc Hook

Returns table of contents entries:

```typescript
function TableOfContents() {
  const toc = useToc()
  
  return (
    <nav>
      {toc.map(item => (
        <a href={`#${item.slug}`} data-depth={item.depth}>
          {item.text}
        </a>
      ))}
    </nav>
  )
}
```

## Frontmatter Access

MDX frontmatter is available in `usePageContent`:

```mdx
---
title: Button Component
description: Interactive button with variants
order: 1
---
```

```typescript
const { frontmatter } = usePageContent()
// frontmatter.title === 'Button Component'
// frontmatter.description === 'Interactive button with variants'
// frontmatter.order === 1
```

## Error Handling

### Loading State

```typescript
if (!module) {
  return <DocsLoading />
}
```

### Error State

```typescript
if (error) {
  return <div className="docs-error">{error.message}</div>
}
```

### 404 Not Found

```typescript
if (!loader) {
  return <DocsNotFound pathname={location.pathname} />
}
```

## CSS Classes

All components use dual class attributes for UI8Kit compatibility:

```tsx
<div className="docs-page" data-class="docs-page">
```

| Class | Purpose |
|-------|---------|
| `docs-page` | Main container |
| `docs-sidebar` | Left navigation |
| `docs-main` | Content + TOC wrapper |
| `docs-content` | Article content |
| `docs-toc` | Table of contents |
| `docs-nav` | Navigation list |
| `docs-nav-link` | Navigation link |
| `toc-item` | TOC entry |

## Development Tips

### Debug Available Routes

```typescript
if (import.meta.env.DEV) {
  console.log('Available routes:', availablePaths)
}
```

### HMR Support

MDX changes trigger HMR automatically via Vite glob imports.

### Add New Page

1. Create `docs/new-page.mdx`
2. Add frontmatter with title
3. Page appears at `/new-page` automatically

### Customize Layout

Modify `DocsLayout` function to change page structure:

```typescript
function DocsLayout() {
  // Add custom sections, modify grid, etc.
}
```
